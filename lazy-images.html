

<style media="screen">
  img {
    width: 100%;
    opacity: 0;
    transition: opacity 1s
  }

  .has-loaded {
    opacity: 1
  }
</style>
<div style="height:110vh">

</div>
<img src="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg" srcset="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/DB19/production/_90398065_brown.jpg?w400 420w, http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg?w800 1200w"  alt="lovely">

<img src="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg" srcset="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/DB19/production/_90398065_brown.jpg?w400 420w, http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg?w800 1200w"  alt="lovely">

<img src="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg" srcset="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/DB19/production/_90398065_brown.jpg?w400 420w, http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg?w800 1200w"  alt="lovely">

<img src="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg" srcset="http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/DB19/production/_90398065_brown.jpg?w400 420w, http://ichef.bbci.co.uk/onesport/cps/800/cpsprodpb/A046/production/_90403014_edmund.jpg?w800 1200w"  alt="lovely">


<script>
function isInViewPort(image){

  var rect = image.getBoundingClientRect();

  // return true if the image is visible and in the viewport top and bottom
  // otherwise return false

  if(rect.width === 0){

    // element is not visible
    return false;
  }

  if(rect.bottom < 0){

    // out of viewport top
    return false;
  }

  if((window.innerHeight - rect.top) < 0){

    // out of viewport bottom
    return false;
  }

  // if it passes all that, its visible
  return true;

}

function check(){
  // get images that don't contain ignore-lazy-load-image
  var imgs = document.querySelectorAll('img:not(.has-loaded)');

  // loop through images
  for(var i = -1;++i<imgs.length;){
    var img = imgs[i];
    // check if image is in viewport
    if(isInViewPort(img)){
      // add the bypass parameter (service worker will no longer block this url);
      img.srcset = img.srcset.replace(/\.jpg\?/g, '.jpg?bypass-service-worker&');
      img.classList.add('has-loaded');
    }
  }
}

if(navigator.serviceWorker){

  navigator.serviceWorker.register('lazy-images.js').then(function(registration){

    setInterval(function(){
      requestAnimationFrame(function(){
        check()
    })}, 250);

  }).catch(function(err){});

}


</script>
